__version__ = (1, 0, 0)

# ‚ñà‚ñà‚ñà‚ïó‚ñë‚ñë‚ñë‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñë‚ñà‚ñà‚ïó‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
# ‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïó‚ñë‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù
# ‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë
# ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù‚ñë‚ñë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ñà‚ñà‚ïî‚ïê‚ñà‚ñà‚ñà‚ñà‚ïë‚ñë‚ñë‚ïö‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñë‚ïö‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó
# ‚ñà‚ñà‚ïë‚ñë‚ïö‚ïê‚ïù‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñë‚ñë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù
# ‚ïö‚ïê‚ïù‚ñë‚ñë‚ñë‚ñë‚ñë‚ïö‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù‚ñë‚ñë‚ïö‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ñë‚ñë‚ïö‚ïê‚ïê‚ïê‚ïê‚ïù‚ñë‚ñë‚ñë‚ñë‚ïö‚ïê‚ïù‚ñë‚ñë‚ñë‚ïö‚ïê‚ïù‚ñë‚ñë‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ñë‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ñë
#                ¬© Copyright 2025
#            ‚úà https://t.me/mead0wssMods

# scope: hikka_only
# scope: hikka_min 1.3.3
# meta developer: @mead0wssMods
# meta banner: https://x0.at/yCcx.jpg

from telethon import events
from .. import loader, utils


@loader.tds
class AutoFormatting(loader.Module):
    """–ú–æ–¥—É–ª—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≤ <pre><code> —Ç–µ–≥–∏."""
    
    strings = {"name": "AutoFormatting"}

    def __init__(self):
        self.enabled = False
        self.quotes_enabled = False  # –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞–≤—ã—á–∫–∏
        self.language = "python"  # —è–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        self.available_languages = [
            "python", "javascript", "html", "css", "bash", "json", 
            "xml", "sql", "php", "java", "cpp", "c", "go", "rust", 
            "ruby", "swift", "kotlin", "typescript", "yaml", "markdown"
        ]

    async def format_message(self, message):
        content = message.text
        if not content:
            return

        # –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–≤—ã—á–∫–∏ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ
        if self.quotes_enabled:
            content = f'"{content}"'

        # –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –≤ pre code —Ç–µ–≥–∏
        formatted_content = f'<pre><code class="language-{self.language}">{content}</code></pre>'
        await message.edit(formatted_content, parse_mode="HTML")

    @loader.command()
    async def autoformat(self, message):
        """–í–∫–ª—é—á–∞–µ—Ç –∏–ª–∏ –æ—Ç–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ <pre><code>."""
        self.enabled = not self.enabled
        status = "–≤–∫–ª—é—á–µ–Ω–æ" if self.enabled else "–≤—ã–∫–ª—é—á–µ–Ω–æ"
        await utils.answer(
            message,
            f"ü™ê <b>–ê–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</b> {status}  ï¬∑·¥•¬∑ î\n"
            f"–¢–µ–∫—É—â–∏–π —è–∑—ã–∫: <code>{self.language}</code>\n"
            f"–ö–∞–≤—ã—á–∫–∏: {'–≤–∫–ª—é—á–µ–Ω—ã' if self.quotes_enabled else '–≤—ã–∫–ª—é—á–µ–Ω—ã'}",
            parse_mode="HTML",
        )

    @loader.command()
    async def aflang(self, message):
        """–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —è–∑—ã–∫ –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: .aflang python"""
        args = utils.get_args_raw(message)
        if not args:
            available = ", ".join(self.available_languages)
            await utils.answer(
                message,
                f"ü™ê <b>–î–æ—Å—Ç—É–ø–Ω—ã–µ —è–∑—ã–∫–∏:</b>\n<code>{available}</code>\n\n"
                f"<b>–¢–µ–∫—É—â–∏–π —è–∑—ã–∫:</b> <code>{self.language}</code>\n\n"
                f"<b>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:</b> <code>.aflang python</code>",
                parse_mode="HTML",
            )

    @loader.command()
    async def afquotes(self, message):
        """–í–∫–ª—é—á–∞–µ—Ç/–≤—ã–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞–≤—ã—á–∫–∏ (—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–µ—Ä–æ–º)."""
        if not self.enabled:
            await utils.answer(
                message,
                "ü™ê <b>–û—à–∏–±–∫–∞!</b> –°–Ω–∞—á–∞–ª–∞ –≤–∫–ª—é—á–∏—Ç–µ –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π <code>.autoformat</code>  ï¬∑·¥•¬∑ î",
                parse_mode="HTML",
            )
            return
        
        self.quotes_enabled = not self.quotes_enabled
        status = "–≤–∫–ª—é—á–µ–Ω—ã" if self.quotes_enabled else "–≤—ã–∫–ª—é—á–µ–Ω—ã"
        quote_text = '–æ–±–æ—Ä–∞—á–∏–≤–∞—Ç—å—Å—è –≤ "–∫–∞–≤—ã—á–∫–∏"' if self.quotes_enabled else '–±–µ–∑ –∫–∞–≤—ã—á–µ–∫'
        await utils.answer(
            message,
            f"ü™ê <b>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞–≤—ã—á–∫–∏</b> {status}  ï¬∑·¥•¬∑ î\n"
            f"–¢–µ–ø–µ—Ä—å —Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç {quote_text}",
            parse_mode="HTML",
        )
            return

        language = args.lower()
        if language in self.available_languages:
            self.language = language
            await utils.answer(
                message,
                f"ü™ê <b>–Ø–∑—ã–∫ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞:</b> <code>{self.language}</code>  ï¬∑·¥•¬∑ î",
                parse_mode="HTML",
            )
        else:
            await utils.answer(
                message,
                f"ü™ê <b>–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —è–∑—ã–∫:</b> <code>{language}</code>\n"
                f"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <code>.aflang</code> –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è —Å–ø–∏—Å–∫–∞ —è–∑—ã–∫–æ–≤",
                parse_mode="HTML",
            )

    @loader.command()
    async def formatnow(self, message):
        """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ <pre><code> —Ç–µ–≥–∏."""
        args = utils.get_args_raw(message)
        if not args:
            await utils.answer(
                message,
                "ü™ê <b>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:</b> <code>.formatnow –≤–∞—à –∫–æ–¥ –∑–¥–µ—Å—å</code>",
                parse_mode="HTML",
            )
            return
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–≤—ã—á–∫–∏ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ –∏ –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–µ—Ä –≤–∫–ª—é—á–µ–Ω
        content = args
        if self.enabled and self.quotes_enabled:
            content = f'"{content}"'
            
        formatted_content = f'<pre><code class="language-{self.language}">{content}</code></pre>'
        await utils.answer(message, formatted_content, parse_mode="HTML")

    @loader.command()
    async def formatlang(self, message):
        """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —è–∑—ã–∫–∞. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: .formatlang python print("hello")"""
        args = utils.get_args_raw(message).split(" ", 1)
        if len(args) < 2:
            await utils.answer(
                message,
                "ü™ê <b>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:</b> <code>.formatlang python –≤–∞—à –∫–æ–¥</code>",
                parse_mode="HTML",
            )
            return
        
        language, code = args
        if language not in self.available_languages:
            await utils.answer(
                message,
                f"ü™ê <b>–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —è–∑—ã–∫:</b> <code>{language}</code>",
                parse_mode="HTML",
            )
            return
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–≤—ã—á–∫–∏ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ –∏ –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–µ—Ä –≤–∫–ª—é—á–µ–Ω
        content = code
        if self.enabled and self.quotes_enabled:
            content = f'"{content}"'
            
        formatted_content = f'<pre><code class="language-{language}">{content}</code></pre>'
        await utils.answer(message, formatted_content, parse_mode="HTML")

    @loader.command()
    async def formatstatus(self, message):
        """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è."""
        status = "–≤–∫–ª—é—á–µ–Ω–æ" if self.enabled else "–≤—ã–∫–ª—é—á–µ–Ω–æ"
        quotes_status = "–≤–∫–ª—é—á–µ–Ω—ã" if self.quotes_enabled else "–≤—ã–∫–ª—é—á–µ–Ω—ã"
        await utils.answer(
            message,
            f"ü™ê <b>–ê–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:</b> {status}\n"
            f"<b>–ö–∞–≤—ã—á–∫–∏:</b> {quotes_status}\n"
            f"<b>–Ø–∑—ã–∫:</b> <code>{self.language}</code>\n\n"
            f"<b>–ö–æ–º–∞–Ω–¥—ã:</b>\n"
            f"<code>.autoformat</code> - –≤–∫–ª/–≤—ã–∫–ª –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n"
            f"<code>.afquotes</code> - –≤–∫–ª/–≤—ã–∫–ª –∫–∞–≤—ã—á–∫–∏\n"
            f"<code>.aflang —è–∑—ã–∫</code> - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —è–∑—ã–∫\n"
            f"<code>.formatnow —Ç–µ–∫—Å—Ç</code> - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å\n"
            f"<code>.formatlang —è–∑—ã–∫ —Ç–µ–∫—Å—Ç</code> - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —è–∑—ã–∫–æ–º",
            parse_mode="HTML",
        )

    @loader.watcher(out=True)
    async def message_watcher(self, message):
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ –∫–æ–º–∞–Ω–¥–∞ –º–æ–¥—É–ª—è
        if not message.text:
            return
            
        commands = [".autoformat", ".afquotes", ".aflang", ".formatnow", ".formatlang", ".formatstatus"]
        text_lower = message.text.lower()
        
        # –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∫–æ–º–∞–Ω–¥—ã - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
        for cmd in commands:
            if text_lower.startswith(cmd):
                return
        
        # –ï—Å–ª–∏ –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ - —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º
        if self.enabled:
            await self.format_message(message)